<!DOCTYPE html>
<html lang="en">
<head>
    <title>Loan Approval Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="page-wrapper">
        <div class="container">
            <div class="header">
                <i class="fas fa-university icon"></i>
                <h1>Loan Approval Predictor</h1>
                <p class="subtitle">AI-powered instant loan eligibility assessment</p>
            </div>

            <form class="predict-form" id="predictForm">
                <div class="input-group">
                    <label for="income">
                        <i class="fas fa-dollar-sign icon-small"></i>
                        Monthly Income
                    </label>
                    <input type="number" id="income" name="income" placeholder="$50,000" min="0" step="1000" required>
                    <span class="input-focus"></span>
                </div>

                <div class="input-group">
                    <label for="loan_amount">
                        <i class="fas fa-coins icon-small"></i>
                        Loan Amount
                    </label>
                    <input type="number" id="loan_amount" name="loan_amount" placeholder="$10,000" min="0" step="1000" required>
                    <span class="input-focus"></span>
                </div>

                <div class="input-group">
                    <label for="credit_score">
                        <i class="fas fa-star icon-small"></i>
                        Credit Score
                    </label>
                    <input type="number" id="credit_score" name="credit_score" placeholder="650-850" min="300" max="850" required>
                    <span class="input-focus"></span>
                </div>

                <div class="input-group">
                    <label for="employment_years">
                        <i class="fas fa-briefcase icon-small"></i>
                        Employment Years
                    </label>
                    <input type="number" id="employment_years" name="employment_years" placeholder="1-30" min="0" max="50" required>
                    <span class="input-focus"></span>
                </div>

                <button type="submit" class="predict-btn">
                    <span class="btn-text">Check Eligibility</span>
                    <div class="btn-loader" id="loader">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </button>
            </form>

            <div class="result-container" id="result">
                <div class="result-placeholder">
                    <i class="fas fa-search-dollar icon-large"></i>
                    <p>Enter your financial details to get instant loan approval prediction</p>
                </div>
            </div>

            <div class="features">
                <div class="feature-item">
                    <i class="fas fa-brain"></i>
                    <span>AI Analysis</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-bolt"></i>
                    <span>Instant Results</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-lock"></i>
                    <span>Secure & Private</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('predictForm').addEventListener('submit', function(e) {
            e.preventDefault();
            predictLoan();
        });

        function predictLoan() {
            // STEP 1: Read input values
            let income = document.getElementById("income").value;
            let loanAmount = document.getElementById("loan_amount").value;
            let creditScore = document.getElementById("credit_score").value;
            let employmentYears = document.getElementById("employment_years").value;

            // STEP 2: Input validation
            if (!income || !loanAmount || !creditScore || !employmentYears) {
                showError("Please fill all fields!");
                return;
            }

            const loader = document.getElementById('loader');
            const btnText = document.querySelector('.btn-text');
            const result = document.getElementById('result');
            
            // Show loading state
            loader.style.display = 'inline-block';
            btnText.style.opacity = '0';
            result.classList.add('loading');

            // STEP 3: Send data to backend
            fetch("/predict", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    income: income,
                    loan_amount: loanAmount,
                    credit_score: creditScore,
                    employment_years: employmentYears
                })
            })
            .then(res => res.json())
            .then(data => {
                // Hide loading state
                loader.style.display = 'none';
                btnText.style.opacity = '1';
                result.classList.remove('loading');
                
                let resultDiv = document.getElementById("result");
                
                if (data.loan_status === "Approved") {
                    resultDiv.innerHTML = `
                        <div class="result-content approved">
                            <div class="status-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3 class="result-title">Loan Approved</h3>
                            <div class="probability-bar">
                                <div class="probability-fill" style="width: ${data.approval_probability}%"></div>
                            </div>
                            <p class="probability-text">${data.approval_probability}% Approval Probability</p>
                            <p class="result-desc">Congratulations! Your loan application has high approval chances.</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result-content rejected">
                            <div class="status-icon">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <h3 class="result-title">Loan Rejected</h3>
                            <div class="probability-bar">
                                <div class="probability-fill" style="width: ${data.approval_probability}%"></div>
                            </div>
                            <p class="probability-text">${data.approval_probability}% Approval Probability</p>
                            <p class="result-desc">Consider improving your credit score or financial profile.</p>
                        </div>
                    `;
                }
            })
            .catch(error => {
                loader.style.display = 'none';
                btnText.style.opacity = '1';
                result.classList.remove('loading');
                showError("Prediction failed. Please try again.");
            });
        }

        function showError(message) {
            document.getElementById('result').innerHTML = `
                <div class="error">
                    <i class="fas fa-exclamation-triangle"></i>
                    ${message}
                </div>
            `;
        }
    </script>
</body>
</html>
